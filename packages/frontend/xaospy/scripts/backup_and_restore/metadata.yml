# =================================================================================================
# METADATA FILE: Backup & Restore Tool
#
# PURPOSE:
#   - Controls UI rendering, option visibility, and validation for backup and restore operations.
#   - Uses `show_if` to control visibility of parameters per action (backup or restore).
#   - Uses `active: true/false` to allow easy toggling of parameter visibility without deleting or commenting.
#   - Only parameters with dynamicOptionsEndpoint/apiEndpoint get fetch buttons.
#
# -------------------------------------------------------------------------------------------------
# SECTION 1: BASIC INFORMATION
# -------------------------------------------------------------------------------------------------
displayName: "Backup & Restore"
description: "A tool to perform configuration backups from a device or restore a configuration to a device. The form will dynamically change based on the selected action."
category: "Device Management"
runnerComponent: "BackupAndRestoreRunner"

# -------------------------------------------------------------------------------------------------
# SECTION 2: CAPABILITIES
# -------------------------------------------------------------------------------------------------
capabilities:
  historyTracking: true
  deviceTargeting: true
  deviceAuth: true
  enableReportSaving: false
  restoreUI: true  # Enables RestoreForm for restore action
  resultsDisplay: true
  enableDebug: true
# -------------------------------------------------------------------------------------------------
# SECTION 3: CAPABILITY CONFIGURATION
# -------------------------------------------------------------------------------------------------
deviceTargeting:
  title: "Target Device Selection"
  description: "Choose target devices for backup or restore operations"
  requiredFields: ["hostname", "inventory_file"]  # At least one must be provided

deviceAuth:
  title: "Device Authentication"
  description: "Provide credentials to access the target device(s)"
  requiredFields: ["username", "password"]

resultsDisplay:
  title: "Final Execution Summary"
  description: "A detailed summary of all successful and failed operations."

# -------------------------------------------------------------------------------------------------
# SECTION 4: PARAMETERS (WITH show_if AND active FOR VISIBILITY CONTROL)
# -------------------------------------------------------------------------------------------------
parameters:
  # Action selection parameter (backup or restore)
  - name: "command"
    label: "Action to Perform"
    type: "radio"
    required: true
    default: "backup"
    options:
      - { value: "backup", label: "Perform Backup" }
      - { value: "restore", label: "Perform Restore" }
    layout: "sidebar"
    description: "Choose whether to back up from or restore to the device."
    active: true

  # Device IP selection for backup operation only (visible for backup)
  - name: "hostname"
    label: "Device IP"
    type: "text"
    required: false
    description: "Enter the device IP or hostname for backup."
    layout: "main"
    show_if: { name: "command", value: "backup" }
    active: true

  # Device IP selection for restore operation only (visible for restore)
  - name: "restore_hostname"
    label: "Device IP for Restore"
    type: "select"
    required: false
    dynamicOptionsEndpoint: "/api/backups/devices"
    description: "Select the device to restore configuration to."
    layout: "main"
    show_if: { name: "command", value: "restore" }
    active: false

  # Backup file selection for restore operation only (visible for restore)
  - name: "backup_file"
    label: "Backup File to Restore"
    type: "select"
    required: false
    dynamicOptionsEndpoint: "/api/backups/files"
    description: "Select a configuration file to restore. Options depend on the selected device."
    layout: "main"
    show_if: { name: "command", value: "restore" }
    active: false

  # Inventory file for inventory mode (toggle visible/invisible using active)
  - name: "inventory_file"
    label: "Inventory File"
    type: "select"
    required: false
    dynamicOptionsEndpoint: "/api/inventories/list"
    description: "Select an inventory file containing device details."
    layout: "main"
    show_if: { name: "command", value: "backup" }
    active: false  # <--- Set to false to hide completely

  # Restore method selection (visible for restore only)
  - name: "type"
    label: "Restore Load Type"
    type: "enum"
    default: "override"
    required: false
    options:
      - { value: "override", label: "Override (full replace)" }
      - { value: "set", label: "Set Commands" }
      - { value: "merge", label: "Merge" }
    description: "The method used to load the configuration onto the device."
    layout: "sidebar"
    show_if: { name: "command", value: "restore" }
    active: true

  # Timeout for confirmed commit during restore (visible for restore only)
  - name: "confirmed_commit_timeout"
    label: "Confirmed Commit Timeout (minutes)"
    type: "number"
    default: 5
    description: "Timeout for confirmed commit. A value of 0 disables this safety feature."
    layout: "sidebar"
    show_if: { name: "command", value: "restore" }
    active: true
